from: https://www.bilibili.com/video/BV1GT4y1A756

# 第1章 k8s概念和架构

## P1-尚硅谷-Kubernetes课程内容介绍

## P2-尚硅谷-Kubernetes介绍和特性

## P3-尚硅谷-Kubernetes集群架构组件

## P4-尚硅谷-Kubernetes核心概念

# 第2章 集群搭建

## P5-尚硅谷-搭建Kubernetes集群（平台规划和部署方式介绍）

## kubeadm方式

### P6-尚硅谷-搭建Kubernetes集群（kubeadm方式）-操作系统初始化
### P7-尚硅谷-搭建Kubernetes集群（kubeadm方式）-部署master节点
### P8-尚硅谷-搭建Kubernetes集群（kubeadm方式）-部署node节点和集群测试

## 二进制方式

### P9-尚硅谷-搭建Kubernetes集群（二进制方式）-搭建步骤介绍
### P10-尚硅谷-搭建Kubernetes集群（二进制方式）-操作系统初始化
### P11-尚硅谷-搭建Kubernetes集群（二进制方式）-生成SSL证书文件
### P12-尚硅谷-搭建Kubernetes集群（二进制方式）-部署etcd集群
### P13-尚硅谷-搭建Kubernetes集群（二进制方式）-为APIServer自签证书
### P14-尚硅谷-搭建Kubernetes集群（二进制方式）-部署Master组件
### P15-尚硅谷-搭建Kubernetes集群（二进制方式）-部署Node组件（安装Docker）
### P16-尚硅谷-搭建Kubernetes集群（二进制方式）-部署Node组件（kubelet和kube-proxy）
### P17-尚硅谷-搭建Kubernetes集群（二进制方式）-部署CNI网络和集群测试

## P18-尚硅谷-搭建Kubernetes集群（两种搭建方式总结）

# 第3章 核心概念

## P20-尚硅谷-Kubernetes核心技术-资源编排（yaml）介绍
## P21-尚硅谷-Kubernetes核心技术-资源编排（yaml）编写方式
## P22-尚硅谷-Kubernetes核心技术-Pod（概述和存在意义）
## P23-尚硅谷-Kubernetes核心技术-Pod（两种实现机制）
## P24-尚硅谷-Kubernetes核心技术-Pod（镜像拉取 重启策略和资源限制）
## P25-尚硅谷-Kubernetes核心技术-Pod（健康检查）
## P26-尚硅谷-Kubernetes核心技术-Pod（调度策略）-创建Pod流程
## P27-尚硅谷-Kubernetes核心技术-Pod（调度策略）-影响Pod调度（资源限制和节点选择器）
## P28-尚硅谷-Kubernetes核心技术-Pod（调度策略）-影响Pod调度（节点亲和性）
## P29-尚硅谷-Kubernetes核心技术-Pod（调度策略）-影响Pod调度（污点和污点容忍）
## P30-尚硅谷-Kubernetes核心技术-Controller（Deployment）-概述和应用场景
## P31-尚硅谷-Kubernetes核心技术-Controller（Deployment）-发布应用
## P32-尚硅谷-Kubernetes核心技术-Controller（Deployment）-升级回滚和弹性伸缩
## P33-尚硅谷-Kubernetes核心技术-Service-概述
## P34-尚硅谷-Kubernetes核心技术-Service-三种类型
## P35-尚硅谷-Kubernetes核心技术-Controller（StatefulSet）-部署有状态应用
## P36-尚硅谷- Kubernetes核心技术-Controller（DaemonSet）-部署守护进程
## P37-尚硅谷-Kubernetes核心技术-Controller（Job和Cronjob）-一次任务和定时任务
## P38-尚硅谷-Kubernetes核心技术-配置管理-Secret
## P39-尚硅谷-Kubernetes核心技术-配置管理-ConfigMap
## P40-尚硅谷-Kubernetes核心技术-集群安全机制（概述）
## P41-尚硅谷-Kubernetes核心技术-集群安全机制（RBAC介绍）
## P42-尚硅谷-Kubernetes核心技术-集群安全机制（RBAC实现鉴权）
## P43-尚硅谷-Kubernetes核心技术-Ingress（概述）
## P44-尚硅谷-Kubernetes核心技术-Ingress（对外暴露应用）
## P45-尚硅谷-Kubernetes核心技术-Helm（引入）
## P46-尚硅谷-Kubernetes核心技术-Helm（概述）
## P47-尚硅谷-Kubernetes核心技术-Helm（安装和配置仓库）
## P48-尚硅谷-Kubernetes核心技术-Helm（快速部署应用）
## P49-尚硅谷-Kubernetes核心技术-Helm（自定义chart部署）
## P50-尚硅谷-Kubernetes核心技术-Helm（chart模板使用）
## P51-尚硅谷-Kubernetes核心技术-Helm（chart模板使用）
## P52-尚硅谷-Kubernetes核心技术-持久化存储（nfs网络存储）
## P53-尚硅谷-Kubernetes核心技术-持久化存储（pv和pvc）

# 第4章 集群监控平台

## P54-尚硅谷-Kubernetes集群资源监控-监控指标和方案
## P55-尚硅谷-Kubernetes集群资源监控-搭建监控平台

# 第5章 搭建高可用k8s集群

## P56-尚硅谷-Kubernetes集群搭建-搭建高可用集群（实现过程介绍）
## P57-尚硅谷-Kubernetes集群搭建-搭建高可用集群（初始化和部署keepalived）
## P58-尚硅谷-Kubernetes集群搭建-搭建高可用集群（部署haproxy和安装docker及其他组件）
## P59-尚硅谷-Kubernetes集群搭建-搭建高可用集群（部署master1节点初始化）
## P60-尚硅谷-Kubernetes集群搭建-搭建高可用集群（部署master2和node节点）

# 第6章 集群环境中部署项目

## P61-尚硅谷-Kubernetes集群部署项目-容器交付流程介绍

### 容器交付流程

- 开发代码阶段：
  - 编写代码
  - 测试
  - 编写DockerfileJava部署项目流程

- 持续交付/集成：
  - 代码编译打包
  - 制作镜像
  - 上传镜像仓库

- 部署
  - 环境准备
  - pod
  - Service
  - Ingress
- 运维
  - 监控
  - 故障排查
  - 升级优化

### k8s部署java项目（细节过程）

制作镜像-> 上传到镜像仓库 -> 控制器部署镜像 -> 对外暴露应用（Service, Ingress) -> 运维

## P62-尚硅谷-Kubernetes集群部署项目-部署Java项目（制作镜像）

1. 打成jar/war包
2. 做成镜像

Dockerfile

```dockerfile
FROM openjdk:8-jdk-alpine
VOLUME /tmp
ADD ./target/demojenkins.jar demojenkins.jar
ENTRYPOINT ["java","-jar","/demojenkins.jar", "&"]
```

```sh
# 在jar包路径下制作镜像
docker build -t java-demo-01:1.0 . 
# 检查image
docker images
# 运行docker
docker run -d -p 8111:8111 java-demo-01:1.0 -t
# 浏览器访问
ipaddress:8111/user
```

## P63-尚硅谷-Kubernetes集群部署项目-部署Java项目（推送镜像）

3. 上传到镜像服务器（阿里云）

```sh
# 1. 登录阿里云Docker Registry
$ sudo docker login --username=cather****@163.com registry.cn-shanghai.aliyuncs.com

# 用于登录的用户名为阿里云账号全名，密码为开通服务时设置的密码。

#您可以在访问凭证页面修改凭证密码。
#2. 从Registry中拉取镜像
$ sudo docker pull registry.cn-shanghai.aliyuncs.com/jstone01/javademo1:[镜像版本号]

#3. 将镜像推送到Registry
$ sudo docker login --username=cather****@163.com registry.cn-shanghai.aliyuncs.com
$ sudo docker tag [ImageId] registry.cn-shanghai.aliyuncs.com/jstone01/javademo1:[镜像版本号]
# 例
sudo docker tag [ImageId] registry.cn-shanghai.aliyuncs.com/jstone01/javademo1:1.0.1

$ sudo docker push registry.cn-shanghai.aliyuncs.com/jstone01/javademo1:[镜像版本号]
# 例
sudo docker push registry.cn-shanghai.aliyuncs.com/jstone01/javademo1:1.0.1

#请根据实际镜像信息替换示例中的[ImageId]和[镜像版本号]参数。
#4. 选择合适的镜像仓库地址
#从ECS推送镜像时，可以选择使用镜像仓库内网地址。推送速度将得到提升并且将不会损耗您的公网流量。

#如果您使用的机器位于VPC网络，请使用 registry-vpc.cn-shanghai.aliyuncs.com 作为Registry的域名登录。
#5. 示例
#使用"docker tag"命令重命名镜像，并将它通过专有网络地址推送至Registry。
$ sudo docker images
REPOSITORY                                                         TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
registry.aliyuncs.com/acs/agent                                    0.7-dfb6816         37bb9c63c8b2        7 days ago          37.89 MB

$ sudo docker tag 37bb9c63c8b2 registry-vpc.cn-shanghai.aliyuncs.com/acs/agent:0.7-dfb6816

#使用 "docker push" 命令将该镜像推送至远程。
$ sudo docker push registry-vpc.cn-shanghai.aliyuncs.com/acs/agent:0.7-dfb6816
```



## P64-尚硅谷-Kubernetes集群部署项目-部署Java项目（部署镜像暴露应用）

4. 部署

```sh
kubectl create deploy javademo01 --image=registry.cn-shanghai.aliyuncs.com/jstone01/javademo1:1.0.1 --dry-run -o yaml > javademo1.yaml
kubectl apply -f javademo1.yaml
```

5. 暴露应用

```sh
kubectl scale deploy javademo01 --replicas=3	#扩容
kubectl expose deploy javademo01 --port=8111 --target-port=8111 --type=NodePort # 暴露端口
kubectl get svc
NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
javademo01   NodePort    10.104.23.232   <none>        8111:31274/TCP   37s

```

